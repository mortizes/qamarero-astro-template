# 3.5 - ¿Como gestionar videos?

## Contexto

**Posicion en arbol:** NIVEL 3.5 - Frontend
**Depende de:** 3.1 (Astro), 3.2 (ISR)
**Afecta a:** Performance, PageSpeed, engagement, analytics

**Requisitos Qamarero:**
- Videos ya existentes en Wistia (integrado)
- PageSpeed 95+ (videos NO deben impactar)
- Analytics de engagement (quien ve, cuanto, donde abandona)
- Lazy loading (no cargar hasta visible)
- Responsive (funciona en mobile)

**Volumen actual:**
- Videos Wistia: ~20-30 existentes
- Uso: Demos producto, testimoniales, tutoriales
- Frecuencia nuevos: ~1-2/mes

**Por que es importante:**
- Videos son heavy (MB, no KB como imagenes)
- Mal implementados destrozan PageSpeed
- Analytics de video = insights de conversion
- Ya tenemos Wistia pagado y funcionando

---

## Opciones

### Opcion A: Wistia (Mantener actual)

**Que es:**
- Plataforma de video marketing profesional
- CDN optimizado para video
- Analytics avanzados (engagement, heatmaps)
- Player personalizable

**Como funciona:**
```
Workflow actual:
├── Marketing sube video a Wistia dashboard
├── Obtiene embed code o video ID
├── Developer inserta en pagina Astro
└── Wistia maneja: streaming, adaptive bitrate, analytics

Arquitectura:
├── Videos: Hosted en Wistia CDN (no en nuestro server)
├── Player: JavaScript async (no bloquea render)
├── Streaming: Adaptive bitrate (calidad segun conexion)
└── Analytics: Dashboard Wistia (engagement, heatmaps)
```

**Ejemplo embed:**
```astro
---
// src/components/WistiaVideo.astro
interface Props {
  videoId: string;
  title: string;
  aspectRatio?: string;
}

const { videoId, title, aspectRatio = '16/9' } = Astro.props;
---

<div class="wistia-wrapper" style={`aspect-ratio: ${aspectRatio};`}>
  <iframe
    src={`https://fast.wistia.net/embed/iframe/${videoId}?videoFoam=true`}
    title={title}
    loading="lazy"
    allow="autoplay; fullscreen"
    frameborder="0"
    scrolling="no"
    class="wistia-embed"
  />
</div>

<style>
  .wistia-wrapper {
    position: relative;
    width: 100%;
    max-width: 100%;
  }

  .wistia-embed {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
  }
</style>
```

#### Pros

```
Ya integrado:
├── Videos existentes funcionando
├── Equipo sabe usarlo
├── $0 adicional (ya pagado)
└── 0 migracion necesaria ✅

Performance:
├── CDN global optimizado para video
├── Adaptive bitrate (auto-ajusta calidad)
├── Lazy loading nativo
├── NO impacta build time (externo) ✅

Analytics avanzados:
├── Engagement rate por video
├── Heatmaps (donde hacen pause, rewind)
├── Drop-off points (donde abandonan)
├── Integracion con CRM/marketing tools ✅

Player profesional:
├── Customizable (colores, logo)
├── Chapters, captions
├── CTA overlays
├── Turnstile (email gates) ✅
```

#### Contras

```
Costo:
├── Plan actual: ~$99/mes (ya pagado)
└── Pero: Ya lo tenemos, no es adicional

Dependencia externa:
├── Si Wistia cae, videos no cargan
└── Riesgo bajo (99.9% uptime SLA)

Personalización limitada:
├── Player es de Wistia (aunque customizable)
└── OK para nuestro caso
```

#### Cuando usar Wistia

```
✅ Ya lo tienes integrado (nuestro caso)
✅ Necesitas analytics de engagement
✅ Videos de marketing/ventas
✅ Presupuesto: $99+/mes aceptable
✅ ESTE ES NUESTRO CASO (Qamarero)
```

---

### Opcion B: YouTube (Embeds)

**Como funciona:**
```
Workflow:
├── Subir video a YouTube
├── Obtener video ID
├── Embed iframe en pagina
└── YouTube maneja streaming

Ejemplo:
<iframe
  src="https://www.youtube.com/embed/VIDEO_ID"
  loading="lazy"
  allow="accelerometer; autoplay; encrypted-media"
/>
```

#### Pros

```
Gratis:
├── $0/mes
├── Hosting ilimitado
└── CDN global de Google ✅

SEO:
├── Videos indexados en YouTube
├── Segundo buscador mas grande
└── Trafico adicional potencial ✅
```

#### Contras para Qamarero

```
Ads y recomendaciones:
├── YouTube puede mostrar ads
├── Videos relacionados al final
├── Puede mostrar competidores ❌

Analytics limitados:
├── Solo metricas basicas (views, watch time)
├── Sin heatmaps
├── Sin integracion CRM
└── NO cumple requisito analytics ❌

Branding:
├── Logo YouTube visible
├── Look "amateur" vs profesional
└── NO ideal para SaaS B2B ❌

Privacy:
├── Tracking de Google
├── GDPR concerns
└── Cookies third-party ⚠️
```

#### Cuando usar YouTube

```
✅ Presupuesto $0
✅ Quieres SEO en YouTube
✅ No importan ads/recomendaciones
✅ Analytics basicos suficientes
❌ NO recomendado para Qamarero (tenemos Wistia)
```

---

### Opcion C: Vimeo

**Como funciona:**
```
Similar a Wistia:
├── Plataforma video profesional
├── Sin ads
├── Analytics basicos
└── Player limpio
```

#### Pros

```
Sin ads:
├── Player limpio
├── Sin recomendaciones
└── Profesional ✅

Mas barato que Wistia:
├── Plan Pro: $20/mes
└── vs Wistia $99/mes
```

#### Contras para Qamarero

```
Analytics inferiores:
├── Sin heatmaps
├── Sin engagement detallado
├── Sin integracion CRM
└── Wistia es superior ❌

Migracion innecesaria:
├── Ya tenemos Wistia
├── Tiempo de migracion
├── Re-entrenar equipo
└── No vale la pena ❌
```

#### Cuando usar Vimeo

```
✅ Nuevo proyecto sin videos
✅ Presupuesto limitado ($20/mes)
✅ Analytics basicos suficientes
❌ NO recomendado para Qamarero (ya tenemos Wistia)
```

---

### Opcion D: Self-hosted (Video en Cloudflare Stream)

**Como funciona:**
```
Cloudflare Stream:
├── Subir videos a Cloudflare
├── CDN global
├── Adaptive streaming
├── $1/1000 min viewed
```

#### Pros

```
Control total:
├── Sin branding externo
├── Player 100% custom
└── Data ownership ✅

Costo variable:
├── Solo pagas por views
├── Puede ser mas barato
└── O mas caro (depende trafico)
```

#### Contras para Qamarero

```
Sin analytics avanzados:
├── Solo metricas basicas
├── Sin heatmaps
├── Sin engagement
└── Wistia es superior ❌

Setup complejo:
├── Configurar player custom
├── Implementar tracking
├── Mantener codigo
└── Mas trabajo ❌

Migracion:
├── Re-subir todos los videos
├── Actualizar embeds
└── No vale la pena ❌
```

#### Cuando usar Self-hosted

```
✅ Volumen muy alto de videos (miles)
✅ Necesitas control total del player
✅ Equipo tecnico para mantener
❌ NO recomendado para Qamarero (overkill)
```

---

## Comparacion Final

| Criterio | Wistia | YouTube | Vimeo | Self-hosted |
|----------|--------|---------|-------|-------------|
| **Costo/mes** | $99 (ya pagado) | $0 | $20 | Variable |
| **Analytics** | Avanzados | Basicos | Medios | Basicos |
| **Heatmaps** | ✅ Si | ❌ No | ❌ No | ❌ No |
| **Ads** | ❌ Sin ads | ⚠️ Posibles | ❌ Sin ads | ❌ Sin ads |
| **Migracion** | ✅ Ninguna | ⚠️ Media | ⚠️ Media | ❌ Alta |
| **Para Qamarero** | **MANTENER** | No | No | No |

---

## Propuesta: Mantener Wistia

### Por que para Qamarero

**1. Ya lo tenemos funcionando**
```
Estado actual:
├── ~20-30 videos en Wistia
├── Equipo sabe usarlo
├── Integrado en web actual
├── $0 adicional (ya pagado)
└── 0 trabajo de migracion ✅
```

**2. Analytics que necesitamos**
```
Wistia Analytics:
├── Engagement rate: % video visto
├── Heatmaps: Donde pause, rewind, skip
├── Drop-off: Donde abandonan
├── Viewer data: Email si usan turnstile
└── Insights para mejorar videos ✅
```

**3. Performance optima**
```
Impacto en PageSpeed:
├── Videos cargados async (no bloquean)
├── Lazy loading nativo
├── CDN global
├── Adaptive bitrate
└── PageSpeed 95+ mantenido ✅
```

**4. No impacta build**
```
Astro build:
├── Videos externos (Wistia CDN)
├── Solo embedemos iframe
├── 0 procesamiento en build
└── Build time: sin impacto ✅
```

---

## Implementacion

### 3.5.1 Componente WistiaVideo

```astro
---
// src/components/WistiaVideo.astro
interface Props {
  videoId: string;
  title: string;
  aspectRatio?: string;
  autoplay?: boolean;
  muted?: boolean;
}

const {
  videoId,
  title,
  aspectRatio = '16/9',
  autoplay = false,
  muted = false
} = Astro.props;

const params = new URLSearchParams({
  videoFoam: 'true',
  autoPlay: autoplay.toString(),
  muted: muted.toString(),
});
---

<div
  class="wistia-wrapper"
  style={`aspect-ratio: ${aspectRatio};`}
>
  <iframe
    src={`https://fast.wistia.net/embed/iframe/${videoId}?${params}`}
    title={title}
    loading="lazy"
    allow="autoplay; fullscreen"
    allowfullscreen
    frameborder="0"
    scrolling="no"
    class="wistia-embed"
  />
</div>

<style>
  .wistia-wrapper {
    position: relative;
    width: 100%;
    max-width: 100%;
    background-color: #000;
    border-radius: 8px;
    overflow: hidden;
  }

  .wistia-embed {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: none;
  }
</style>
```

### 3.5.2 Componente con Poster (Performance Optima)

```astro
---
// src/components/WistiaVideoLazy.astro
// Version con poster image para maxima performance
interface Props {
  videoId: string;
  title: string;
  posterUrl?: string;
  aspectRatio?: string;
}

const {
  videoId,
  title,
  posterUrl,
  aspectRatio = '16/9'
} = Astro.props;

// Wistia genera poster automaticamente
const defaultPoster = `https://fast.wistia.com/embed/medias/${videoId}/swatch`;
const poster = posterUrl || defaultPoster;
---

<div
  class="wistia-lazy"
  data-video-id={videoId}
  style={`aspect-ratio: ${aspectRatio};`}
>
  <img
    src={poster}
    alt={`Play: ${title}`}
    loading="lazy"
    class="wistia-poster"
  />
  <button class="wistia-play-btn" aria-label={`Play ${title}`}>
    <svg viewBox="0 0 24 24" fill="currentColor">
      <path d="M8 5v14l11-7z"/>
    </svg>
  </button>
</div>

<script>
  // Solo carga iframe cuando usuario hace click
  document.querySelectorAll('.wistia-lazy').forEach(wrapper => {
    wrapper.addEventListener('click', () => {
      const videoId = wrapper.dataset.videoId;
      const iframe = document.createElement('iframe');
      iframe.src = `https://fast.wistia.net/embed/iframe/${videoId}?autoPlay=true`;
      iframe.allow = 'autoplay; fullscreen';
      iframe.allowFullscreen = true;
      iframe.className = 'wistia-embed';
      wrapper.innerHTML = '';
      wrapper.appendChild(iframe);
    });
  });
</script>

<style>
  .wistia-lazy {
    position: relative;
    width: 100%;
    background-color: #000;
    border-radius: 8px;
    overflow: hidden;
    cursor: pointer;
  }

  .wistia-poster {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .wistia-play-btn {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 80px;
    height: 80px;
    background: rgba(0, 0, 0, 0.7);
    border: none;
    border-radius: 50%;
    color: white;
    cursor: pointer;
    transition: background 0.2s;
  }

  .wistia-play-btn:hover {
    background: rgba(0, 0, 0, 0.9);
  }

  .wistia-play-btn svg {
    width: 40px;
    height: 40px;
  }

  .wistia-embed {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: none;
  }
</style>
```

---

## Trade-offs Aceptados

| Trade-off | Aceptado porque... |
|-----------|---------------------|
| Costo $99/mes | Ya pagado, analytics lo justifican |
| Dependencia Wistia | 99.9% uptime, riesgo aceptable |
| Player no 100% custom | Suficientemente customizable |

---

## Criterios Go/No-Go

### Criterios de Exito

- [ ] **Componente:** Video carga y reproduce
- [ ] **Responsive:** Funciona en mobile
- [ ] **Lazy loading:** No carga hasta necesario
- [ ] **PageSpeed:** >95 con video en pagina
- [ ] **Analytics:** Views y heatmaps funcionan

### Decision Gate

```
TODOS criterios ✅?
│
├── Si → ✅ APROBAR Wistia (mantener)
│         └── Pasar a 3.6 (Componentes UI)
│
└── No → ⚠️ ITERAR sobre problema especifico
          ├── Video no carga: Verificar video ID
          ├── PageSpeed bajo: Usar lazy loading
          └── Analytics no funcionan: Verificar Wistia config
```

---

## Referencias

- **Wistia Embed:** https://wistia.com/support/developers/embed-options
- **Wistia Analytics:** https://wistia.com/support/stats
- **Lazy Loading Videos:** https://web.dev/lazy-loading-video/
- **3.4:** [3.4-Gestion-Imagenes.md](./3.4-Gestion-Imagenes.md)

---

**Preparado por:** Miguel Ortiz Peralta
**Fecha:** 3 Febrero 2026
**Version:** 1.0
**Estado:** Pendiente de validar en POC
