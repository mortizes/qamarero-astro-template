# 4.3 - Â¿CÃ³mo segregar permisos por paÃ­s?

## ğŸ“‹ Contexto

**PosiciÃ³n en Ã¡rbol:** NIVEL 4.3 - Multi-idioma
**Depende de:** 1.3 (WordPress Multisite), 4.2 (Multi-idioma cÃ³digo)
**Afecta a:** Seguridad, workflows editoriales, autonomÃ­a equipos

**Requisitos Qamarero:**
- Marketing ES NO puede editar contenido FR (ni CMS, ni cÃ³digo)
- Carlos FR NO puede editar contenido ES (ni CMS, ni cÃ³digo)
- Cada paÃ­s tiene autonomÃ­a total sobre su contenido
- AuditorÃ­a: Saber quiÃ©n cambiÃ³ quÃ© y cuÃ¡ndo

**Por quÃ© es importante:**
- Previene errores accidentales (editar contenido de otro paÃ­s)
- Permite trabajo en paralelo sin conflictos
- Cumple con autonomÃ­a por paÃ­s (requisito clave)
- Facilita auditorÃ­a y troubleshooting

---

## ğŸ¯ DecisiÃ³n

**Pregunta fundamental:**
**"Â¿CÃ³mo aseguramos que cada equipo solo edita su contenido en CMS y CÃ³digo?"**

**Dos sistemas de segregaciÃ³n:**
1. **CMS (WordPress):** Roles nativos de Multisite + permisos por site
2. **CÃ³digo (GitHub):** CODEOWNERS + Branch protection + PR reviews

---

## âš–ï¸ Opciones

### DecisiÃ³n 4.3.1: SegregaciÃ³n en CMS

#### OpciÃ³n A: WordPress Multisite + Roles Nativos â­

**Arquitectura:**
```
WordPress Multisite:
â”œâ”€â”€ Site ES (qamarero.com)
â”‚   â”œâ”€â”€ Marketing ES: Editor (solo site ES)
â”‚   â””â”€â”€ Acceso: wp-admin de qamarero.com
â”œâ”€â”€ Site FR (qamarero.com/fr)
â”‚   â”œâ”€â”€ Carlos FR: Editor (solo site FR)
â”‚   â””â”€â”€ Acceso: wp-admin de qamarero.com/fr
â””â”€â”€ Network Admin
    â”œâ”€â”€ Miguel/Serrano: Super Admin
    â””â”€â”€ Acceso: Todos los sites + network
```

**CÃ³mo funciona:**
```
User "Marketing ES":
â”œâ”€â”€ Role: Editor en site ES
â”œâ”€â”€ Puede: Ver/editar posts ES
â”œâ”€â”€ NO puede: Acceder a wp-admin de site FR
â””â”€â”€ NO puede: Ver posts FR (ni en GraphQL)

User "Carlos FR":
â”œâ”€â”€ Role: Editor en site FR
â”œâ”€â”€ Puede: Ver/editar posts FR
â”œâ”€â”€ NO puede: Acceder a wp-admin de site ES
â””â”€â”€ NO puede: Ver posts ES (ni en GraphQL)
```

**Roles disponibles:**
```
Super Admin (Miguel/Serrano):
â””â”€â”€ Acceso: Todos los sites + network settings

Administrator (por site):
â””â”€â”€ Acceso: ConfiguraciÃ³n completa del site

Editor (Marketing ES, Carlos FR):
â”œâ”€â”€ Puede: Crear, editar, publicar posts
â”œâ”€â”€ Puede: Subir media
â””â”€â”€ NO puede: Cambiar plugins, themes, settings

Author:
â”œâ”€â”€ Puede: Crear y publicar solo sus posts
â””â”€â”€ NO puede: Editar posts de otros

Contributor:
â”œâ”€â”€ Puede: Crear posts (pendientes aprobaciÃ³n)
â””â”€â”€ NO puede: Publicar directamente
```

**Pros:**
- âœ… SegregaciÃ³n nativa (arquitectura, no configuraciÃ³n)
- âœ… Editor ES NO PUEDE acceder a FR (imposible por error)
- âœ… Sin plugins adicionales (roles nativos WordPress)
- âœ… GraphQL respeta permisos (solo expone site actual)

**Contras:**
- âš ï¸ Requiere crear usuarios por site (no global)
- âš ï¸ Super Admin ve todo (pero es necesario)

**CuÃ¡ndo usar:**
```
âœ… WordPress Multisite (ya decidido en 1.3)
âœ… Equipos separados por paÃ­s
âœ… Necesitas segregaciÃ³n total
âœ… Este es nuestro caso (Qamarero) âœ…
```

---

#### OpciÃ³n B: Single Site + Plugin Roles Custom

**QuÃ© es:**
- WordPress Single Site con plugin como "User Role Editor"
- Roles custom por idioma (Editor ES, Editor FR)
- Restricciones por taxonomÃ­a o custom field

**Contras:**
- âŒ SegregaciÃ³n dÃ©bil (basada en filtros, no arquitectura)
- âŒ Editor ES puede ver posts FR si accede mal
- âŒ Requiere plugin de pago ($49/aÃ±o)
- âŒ Complejo de configurar y mantener

**CuÃ¡ndo usar:**
```
âœ… Single Site obligatorio (no aplica, tenemos Multisite)
âŒ NO recomendado para Qamarero
```

---

### DecisiÃ³n 4.3.2: SegregaciÃ³n en CÃ³digo

#### OpciÃ³n A: GitHub CODEOWNERS + Branch Protection â­

**Arquitectura:**
```
GitHub repository:
â”œâ”€â”€ main branch (protected)
â”‚   â””â”€â”€ Requiere PR + review para merge
â”œâ”€â”€ CODEOWNERS file
â”‚   â”œâ”€â”€ src/pages/*.astro â†’ @qamarero/dev-team
â”‚   â”œâ”€â”€ src/pages/fr/** â†’ @qamarero/fr-team
â”‚   â””â”€â”€ src/content/es/** â†’ @qamarero/es-team
â””â”€â”€ Branch protection rules
    â”œâ”€â”€ Require PR reviews (1+ approvals)
    â”œâ”€â”€ Require CODEOWNERS approval
    â””â”€â”€ Block direct push to main
```

**CODEOWNERS ejemplo:**
```
# CODEOWNERS file (root del repo)

# Default: Dev team revisa todo
* @qamarero/dev-team

# Contenido ES: Solo team ES + dev team
/src/pages/index.astro @qamarero/es-team @qamarero/dev-team
/src/pages/features.astro @qamarero/es-team @qamarero/dev-team
/src/pages/pricing.astro @qamarero/es-team @qamarero/dev-team
/src/content/es/** @qamarero/es-team @qamarero/dev-team

# Contenido FR: Solo team FR + dev team
/src/pages/fr/** @qamarero/fr-team @qamarero/dev-team
/src/content/fr/** @qamarero/fr-team @qamarero/dev-team

# ConfiguraciÃ³n crÃ­tica: Solo dev team
astro.config.mjs @qamarero/dev-team
package.json @qamarero/dev-team
vercel.json @qamarero/dev-team
```

**GitHub Teams:**
```
@qamarero/dev-team:
â”œâ”€â”€ Miguel (Admin)
â”œâ”€â”€ Serrano (Admin)
â””â”€â”€ Permisos: Write en todo el repo

@qamarero/es-team:
â”œâ”€â”€ Marketing ES (Write)
â””â”€â”€ Permisos: Solo archivos ES

@qamarero/fr-team:
â”œâ”€â”€ Carlos FR (Write)
â””â”€â”€ Permisos: Solo archivos FR
```

**Workflow:**
```
Marketing ES quiere editar Features ES:
1. Crea branch: feature/update-features-es
2. Edita: src/pages/features.astro
3. Commit + push
4. Abre PR a main
5. CODEOWNERS: Requiere approval de @qamarero/es-team + @qamarero/dev-team
6. Dev team revisa â†’ Approve
7. Merge a main â†’ Deploy

Marketing ES intenta editar Features FR:
1. Crea branch: feature/update-features-fr
2. Edita: src/pages/fr/features.astro
3. Commit + push
4. Abre PR a main
5. CODEOWNERS: Requiere approval de @qamarero/fr-team (NO es miembro)
6. Carlos FR debe revisar â†’ Marketing ES NO puede mergear solo âœ…
7. SegregaciÃ³n efectiva (no puede publicar sin aprobaciÃ³n FR)
```

**Pros:**
- âœ… SegregaciÃ³n por carpeta (archivos ES vs FR)
- âœ… PR review obligatorio (no push directo a main)
- âœ… CODEOWNERS automÃ¡tico (GitHub asigna reviewers)
- âœ… AuditorÃ­a completa (Git history + PR comments)
- âœ… Gratis (GitHub native feature)

**Contras:**
- âš ï¸ Requiere configuraciÃ³n inicial (CODEOWNERS + branch protection)
- âš ï¸ Marketing debe aprender Git workflow (branch + PR)

**CuÃ¡ndo usar:**
```
âœ… Contenido multi-idioma en cÃ³digo
âœ… Equipos separados por paÃ­s
âœ… Necesitas auditorÃ­a (quiÃ©n cambiÃ³ quÃ©)
âœ… Este es nuestro caso (Qamarero) âœ…
```

---

#### OpciÃ³n B: Manual Review (Sin CODEOWNERS)

**QuÃ© es:**
- Branch protection sin CODEOWNERS
- Reviews manuales (no automÃ¡ticas)
- Confiar en que dev team asigna reviewer correcto

**Contras:**
- âŒ FÃ¡cil olvidar asignar reviewer correcto
- âŒ Marketing ES puede mergear cambios FR si dev team aprueba sin revisar
- âŒ Sin segregaciÃ³n automÃ¡tica

**CuÃ¡ndo usar:**
```
âœ… Repo muy pequeÃ±o (<3 personas)
âŒ NO recomendado para Qamarero (equipos separados)
```

---

### DecisiÃ³n 4.3.3: Workflow AprobaciÃ³n Cambios

#### OpciÃ³n A: PR Review Obligatorio (1+ Approvals) â­

**GitHub branch protection:**
```yaml
Branch: main
â”œâ”€â”€ Require pull request before merging: âœ…
â”œâ”€â”€ Require approvals: 1
â”œâ”€â”€ Require review from Code Owners: âœ…
â”œâ”€â”€ Dismiss stale reviews: âœ…
â””â”€â”€ Require linear history: âœ…
```

**Workflow:**
```
Editor crea cambio:
    â†“
Crea branch + commit + push
    â†“
Abre Pull Request a main
    â†“
GitHub asigna reviewers (CODEOWNERS)
    â†“
Reviewer aprueba (1+ approvals)
    â†“
Merge a main (automÃ¡tico o manual)
    â†“
Vercel deploy (CI/CD automÃ¡tico)
```

**Pros:**
- âœ… Previene push directo a main (error humano)
- âœ… Siempre hay revisiÃ³n (2 pares de ojos)
- âœ… CODEOWNERS asigna reviewer correcto automÃ¡ticamente

**Contras:**
- âš ï¸ AÃ±ade fricciÃ³n (no deploy instantÃ¡neo)
- âš ï¸ Requiere reviewer disponible (bottleneck si nadie aprueba)

**CuÃ¡ndo usar:**
```
âœ… Cambios crÃ­ticos (pÃ¡ginas corporativas)
âœ… Equipos separados (prevenir errores cross-team)
âœ… Este es nuestro caso (Qamarero) âœ…
```

---

#### OpciÃ³n B: Auto-merge (Sin Review)

**QuÃ© es:**
- Push directo a main (sin PR)
- O PR con auto-merge (sin approval)

**Contras:**
- âŒ Sin revisiÃ³n (errores pasan a producciÃ³n)
- âŒ Sin segregaciÃ³n (cualquiera puede cambiar todo)

**CuÃ¡ndo usar:**
```
âœ… Proyecto personal (1 persona)
âŒ NO recomendado para Qamarero (equipos mÃºltiples)
```

---

### DecisiÃ³n 4.3.4: AuditorÃ­a y Logging

#### OpciÃ³n A: Git History + GitHub Actions Log â­

**QuÃ© auditar:**
```
CMS (WordPress):
â”œâ”€â”€ QuiÃ©n: User ID + email
â”œâ”€â”€ QuÃ©: Post creado/editado/publicado
â”œâ”€â”€ CuÃ¡ndo: Timestamp (UTC)
â””â”€â”€ DÃ³nde: WordPress Activity Log plugin (gratis)

CÃ³digo (GitHub):
â”œâ”€â”€ QuiÃ©n: GitHub username + email
â”œâ”€â”€ QuÃ©: Archivos cambiados (Git diff)
â”œâ”€â”€ CuÃ¡ndo: Commit timestamp
â”œâ”€â”€ Por quÃ©: Commit message + PR description
â””â”€â”€ DÃ³nde: Git history (nativo)
```

**WordPress Activity Log plugin:**
```
Install: WP Activity Log (gratis)

Eventos registrados:
â”œâ”€â”€ User login/logout
â”œâ”€â”€ Post created/edited/published/deleted
â”œâ”€â”€ Media uploaded
â”œâ”€â”€ Plugin activated/deactivated
â””â”€â”€ Settings changed

RetenciÃ³n: 90 dÃ­as (configurable)
Acceso: Solo Super Admin
```

**GitHub audit:**
```bash
# Ver cambios por usuario
git log --author="marketing-es@qamarero.com" --oneline

# Ver cambios en archivos FR
git log --follow -- src/pages/fr/**

# Ver quiÃ©n cambiÃ³ lÃ­nea especÃ­fica
git blame src/pages/fr/features.astro
```

**Pros:**
- âœ… AuditorÃ­a completa (CMS + cÃ³digo)
- âœ… Gratis (WP Activity Log + Git nativo)
- âœ… Permanente (Git history inmutable)

**Contras:**
- âš ï¸ WordPress log limitado a 90 dÃ­as (configurable)

**CuÃ¡ndo usar:**
```
âœ… Siempre (best practice)
âœ… Qamarero lo necesita âœ…
```

---

## ğŸ“Š ComparaciÃ³n Final

| Criterio | Multisite Roles | Single Site + Plugin | CODEOWNERS | Manual Review |
|----------|----------------|---------------------|------------|---------------|
| **SegregaciÃ³n CMS** | âœ… Total (arquitectura) | âš ï¸ DÃ©bil (filtros) | N/A | N/A |
| **SegregaciÃ³n CÃ³digo** | N/A | N/A | âœ… AutomÃ¡tica (CODEOWNERS) | âš ï¸ Manual |
| **PrevenciÃ³n errores** | âœ… Imposible acceder otro site | âš ï¸ Posible con filtros | âœ… PR review obligatorio | âš ï¸ Dependiente de humano |
| **AuditorÃ­a** | âœ… WP Activity Log | âœ… WP Activity Log | âœ… Git history | âœ… Git history |
| **Coste** | $0 (nativo) | $49/aÃ±o (plugin) | $0 (nativo) | $0 |
| **Curva aprendizaje** | â±ï¸ 0 horas (roles nativos) | â±ï¸ 4 horas (config) | â±ï¸ 2 horas (Git workflow) | â±ï¸ 1 hora |
| **Para Qamarero** | âœ… IDEAL | âŒ Innecesario | âœ… IDEAL | âš ï¸ Insuficiente |

---

## ğŸ’¡ Propuesta: SegregaciÃ³n HÃ­brida

### Por quÃ© para Qamarero

**1. CMS: WordPress Multisite + Roles Nativos**
```
SegregaciÃ³n total:
â”œâ”€â”€ Editor ES: Solo accede site ES (qamarero.com/wp-admin)
â”œâ”€â”€ Editor FR: Solo accede site FR (qamarero.com/fr/wp-admin)
â””â”€â”€ Super Admin: Accede todos los sites (Miguel/Serrano)

Ventajas:
â””â”€â”€ Imposible editar contenido de otro paÃ­s (arquitectura) âœ…
```

**2. CÃ³digo: GitHub CODEOWNERS + Branch Protection**
```
SegregaciÃ³n por carpeta:
â”œâ”€â”€ src/pages/*.astro â†’ Dev team
â”œâ”€â”€ src/pages/fr/** â†’ FR team + Dev team
â””â”€â”€ src/content/es/** â†’ ES team + Dev team

Workflow:
â”œâ”€â”€ PR review obligatorio (1+ approvals)
â”œâ”€â”€ CODEOWNERS asigna reviewer automÃ¡tico
â””â”€â”€ No push directo a main âœ…
```

**3. AuditorÃ­a: WP Activity Log + Git History**
```
CMS: WP Activity Log (90 dÃ­as)
CÃ³digo: Git history (permanente)
Acceso: Super Admin / Dev team âœ…
```

---

## âš ï¸ Trade-offs Aceptados

| Trade-off | Aceptado porque... |
|-----------|----------------------|
| PR review aÃ±ade fricciÃ³n | Previene errores crÃ­ticos en producciÃ³n |
| Marketing debe aprender Git | Workflow estÃ¡ndar industria, vale la pena |
| Super Admin ve todo | Necesario para troubleshooting y soporte |
| WP Activity Log 90 dÃ­as | Suficiente para auditorÃ­a reciente (Git es permanente) |

---

## ğŸ§ª ValidaciÃ³n en POC

### Test 4.3.1: SegregaciÃ³n CMS (WordPress)

**Setup:**
```
Users:
â”œâ”€â”€ marketing-es@qamarero.com
â”‚   â”œâ”€â”€ Role: Editor en site ES
â”‚   â””â”€â”€ Email: marketing-es@qamarero.com
â”œâ”€â”€ carlos@qamarero.com
â”‚   â”œâ”€â”€ Role: Editor en site FR
â”‚   â””â”€â”€ Email: carlos@qamarero.com
â””â”€â”€ miguel@qamarero.com
    â”œâ”€â”€ Role: Super Admin (network)
    â””â”€â”€ Email: miguel@qamarero.com
```

**Tests:**
```
Test A: Editor ES intenta acceder FR
1. Login como marketing-es@qamarero.com
2. Dashboard muestra SOLO posts ES
3. Intentar acceder: qamarero.com/fr/wp-admin
4. Resultado esperado: Error 403 "No tienes permiso" âœ…

Test B: Editor FR intenta acceder ES
1. Login como carlos@qamarero.com
2. Dashboard muestra SOLO posts FR
3. Intentar acceder: qamarero.com/wp-admin
4. Resultado esperado: Error 403 "No tienes permiso" âœ…

Test C: GraphQL respeta permisos
1. Query GraphQL endpoint ES: /graphql
2. Resultado: Solo posts ES (no mezcla FR) âœ…
3. Query GraphQL endpoint FR: /fr/graphql
4. Resultado: Solo posts FR (no mezcla ES) âœ…
```

**MÃ©tricas:**
- [ ] Editor ES NO ve posts FR: 100%
- [ ] Editor FR NO ve posts ES: 100%
- [ ] GraphQL segrega correctamente: 100%

---

### Test 4.3.2: SegregaciÃ³n CÃ³digo (GitHub)

**Setup:**
```
1. Crear archivo CODEOWNERS en root:
   /src/pages/*.astro @qamarero/dev-team
   /src/pages/fr/** @qamarero/fr-team @qamarero/dev-team
   /src/content/es/** @qamarero/es-team @qamarero/dev-team

2. Configurar branch protection en main:
   âœ… Require PR before merge
   âœ… Require 1+ approvals
   âœ… Require CODEOWNERS approval

3. Crear GitHub teams:
   @qamarero/es-team: marketing-es
   @qamarero/fr-team: carlos-fr
   @qamarero/dev-team: miguel, serrano
```

**Tests:**
```
Test A: Marketing ES edita archivo ES
1. User: marketing-es
2. Edita: src/pages/features.astro
3. Abre PR
4. CODEOWNERS asigna: @qamarero/es-team + @qamarero/dev-team âœ…
5. Dev team aprueba â†’ Merge OK âœ…

Test B: Marketing ES intenta editar archivo FR
1. User: marketing-es
2. Edita: src/pages/fr/features.astro
3. Abre PR
4. CODEOWNERS asigna: @qamarero/fr-team + @qamarero/dev-team âœ…
5. Marketing ES NO puede auto-approve (no es miembro fr-team) âœ…
6. Carlos FR debe aprobar â†’ SegregaciÃ³n efectiva âœ…

Test C: Push directo a main bloqueado
1. User: marketing-es
2. Intenta: git push origin main (directo)
3. Resultado: Error "Branch protection rules" âœ…
4. Debe crear PR â†’ Workflow correcto âœ…
```

**MÃ©tricas:**
- [ ] CODEOWNERS asigna reviewer correcto: 100%
- [ ] Push directo a main bloqueado: 100%
- [ ] Marketing ES NO puede mergear cambios FR sin approval: 100%

---

### Test 4.3.3: Workflow Completo (End-to-End)

**Escenario:** Marketing ES actualiza pÃ¡gina Features ES

```
Paso 1: Crear branch
$ git checkout -b feature/update-features-es

Paso 2: Editar archivo
$ nano src/pages/features.astro
(Cambiar texto hero)

Paso 3: Commit y push
$ git add src/pages/features.astro
$ git commit -m "Update hero text in Features ES"
$ git push origin feature/update-features-es

Paso 4: Abrir PR en GitHub
- TÃ­tulo: "Update hero text in Features ES"
- Description: "Cambio solicitado por marketing"
- Reviewers: Auto-asignados por CODEOWNERS âœ…
  - @qamarero/es-team
  - @qamarero/dev-team

Paso 5: Review
- Dev team (miguel) revisa cÃ³digo
- Aprueba PR (1 approval)
- GitHub permite merge (branch protection OK) âœ…

Paso 6: Merge
- Click "Merge pull request"
- Branch feature/update-features-es â†’ main
- Deploy automÃ¡tico Vercel âœ…

Paso 7: Verificar cambio
- Visitar qamarero.com/features
- Hero text actualizado âœ…
```

**MÃ©tricas:**
- [ ] Workflow completo <10 min (desde edit hasta deploy)
- [ ] PR review obligatorio: 100%
- [ ] Deploy automÃ¡tico tras merge: 100%

---

### Test 4.3.4: AuditorÃ­a

**Setup:**
```
1. Instalar WP Activity Log en WordPress
2. Configurar retenciÃ³n: 90 dÃ­as
3. Activar eventos: Posts, Media, Users, Settings
```

**Tests:**
```
Test A: Auditar cambio en CMS
1. Marketing ES publica post "MenÃº del dÃ­a"
2. Abrir WP Activity Log
3. Buscar evento: "Post published"
4. Verificar:
   - User: marketing-es@qamarero.com âœ…
   - Post: "MenÃº del dÃ­a" âœ…
   - Timestamp: [fecha/hora UTC] âœ…
   - Site: ES (not FR) âœ…

Test B: Auditar cambio en cÃ³digo
1. Marketing ES edita features.astro
2. Ejecutar: git log --author="marketing-es"
3. Verificar:
   - Commit: "Update hero text in Features ES" âœ…
   - Files changed: src/pages/features.astro âœ…
   - Timestamp: [fecha/hora] âœ…
4. Ejecutar: git blame src/pages/features.astro
5. Verificar lÃ­nea cambiada por marketing-es âœ…

Test C: Git history es inmutable
1. Intentar modificar commit pasado
2. Git previene rewrite de history pÃºblica âœ…
3. AuditorÃ­a permanente garantizada âœ…
```

**MÃ©tricas:**
- [ ] WP Activity Log registra todos los eventos: 100%
- [ ] Git history muestra autor correcto: 100%
- [ ] AuditorÃ­a accesible para Super Admin/Dev team: 100%

---

## ğŸ“Š IntegraciÃ³n con Workflows

### Workflow CMS (WordPress)

```
Marketing ES:
1. Login: qamarero.com/wp-admin
2. Ve: Solo posts ES (dashboard)
3. Crea: Nuevo post "5 ideas menÃº del dÃ­a"
4. Sube: Featured image (Media Library ES)
5. Publica: Post visible inmediatamente
6. Log: WP Activity Log registra evento

Carlos FR:
1. Login: qamarero.com/fr/wp-admin
2. Ve: Solo posts FR (dashboard)
3. Crea: Nuevo post "5 idÃ©es menu du jour"
4. Sube: Featured image (Media Library FR)
5. Publica: Post visible inmediatamente
6. Log: WP Activity Log registra evento

SegregaciÃ³n: âœ… Marketing ES NO ve trabajo de Carlos FR
```

### Workflow CÃ³digo (GitHub)

```
Marketing ES:
1. Clone repo: git clone [repo]
2. Branch: git checkout -b feature/update-pricing-es
3. Edita: src/pages/pricing.astro
4. Commit: git commit -m "Update pricing table ES"
5. Push: git push origin feature/update-pricing-es
6. PR: Abre pull request en GitHub
7. Review: CODEOWNERS asigna @qamarero/es-team + @qamarero/dev-team
8. Approval: Dev team aprueba
9. Merge: GitHub merge a main
10. Deploy: Vercel auto-deploy

Carlos FR:
1. Clone repo: git clone [repo]
2. Branch: git checkout -b feature/update-pricing-fr
3. Edita: src/pages/fr/pricing.astro
4. Commit: git commit -m "Update pricing table FR"
5. Push: git push origin feature/update-pricing-fr
6. PR: Abre pull request en GitHub
7. Review: CODEOWNERS asigna @qamarero/fr-team + @qamarero/dev-team
8. Approval: Dev team aprueba
9. Merge: GitHub merge a main
10. Deploy: Vercel auto-deploy

SegregaciÃ³n: âœ… Ambos trabajan en paralelo sin conflictos
```

---

## âœ… Criterios Go/No-Go

### Criterios de Ã‰xito (TODOS deben cumplirse)

**CMS (WordPress):**
- [ ] Editor ES NO puede ver posts FR (manual test + GraphQL)
- [ ] Editor FR NO puede ver posts ES (manual test + GraphQL)
- [ ] Super Admin puede ver todos los sites (troubleshooting)
- [ ] WP Activity Log registra eventos: 100%

**CÃ³digo (GitHub):**
- [ ] CODEOWNERS asigna reviewer correcto automÃ¡ticamente
- [ ] Push directo a main bloqueado: 100%
- [ ] Marketing ES NO puede mergear cambios FR sin approval FR team
- [ ] Git history auditable: 100%

**Workflow:**
- [ ] Workflow completo (edit â†’ PR â†’ merge â†’ deploy): <10 min
- [ ] PR review obligatorio: 100%
- [ ] SegregaciÃ³n efectiva: 0 errores cross-team en tests

### DecisiÃ³n Gate

```
TODOS criterios âœ…?
â”‚
â”œâ”€ SÃ­ â†’ âœ… APROBAR segregaciÃ³n hÃ­brida
â”‚        â””â”€ Pasar a NIVEL 5.1 (IntegraciÃ³n WP-Astro)
â”‚
â””â”€ No â†’ âš ï¸ ITERAR sobre problema especÃ­fico
         â”œâ”€ CMS falla: Revisar roles WordPress
         â”œâ”€ CÃ³digo falla: Ajustar CODEOWNERS + branch protection
         â””â”€ Workflow lento: Simplificar proceso (pero mantener review)
```

---

## ğŸ”„ CuÃ¡ndo Reconsiderar

**Cambiar a segregaciÃ³n mÃ¡s simple si:**
- Equipo reduce a 1-2 personas (todos confÃ­an mutuamente)
- Contenido multi-idioma desaparece (solo 1 idioma)
- Velocidad es crÃ­tica (PR review es bottleneck)

**Por ahora NO aplica:** Equipos separados (ES, FR) + autonomÃ­a por paÃ­s requiere segregaciÃ³n estricta.

---

## ğŸ“š Referencias

- **1.3:** WordPress Multisite (segregaciÃ³n CMS nativa)
- **4.2:** Multi-idioma cÃ³digo (estructura archivos por idioma)
- **GitHub CODEOWNERS:** https://docs.github.com/en/repositories/managing-your-repositorys-settings-and-features/customizing-your-repository/about-code-owners
- **Branch protection:** https://docs.github.com/en/repositories/configuring-branches-and-merges-in-your-repository/managing-protected-branches
- **WP Activity Log:** https://wordpress.org/plugins/wp-security-audit-log/

---

**Preparado por:** Miguel Ortiz Peralta
**Fecha:** 3 Febrero 2026
**VersiÃ³n:** 1.0
**Estado:** â³ Pendiente de validar en POC
